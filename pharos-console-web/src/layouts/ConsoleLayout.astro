---
/* ========================================================================
 * Project: pharos
 * Component: Web Console
 * File: src/layouts/ConsoleLayout.astro
 * Author: Richard D. (https://github.com/iamrichardd)
 * License: AGPL-3.0 (See LICENSE file for details)
 * * Purpose (The "Why"):
 * Provides the consistent mobile-first layout wrapper for all Console pages,
 * ensuring shared navigation and global styles are applied uniformly.
 * * Traceability:
 * Related to Task 16.2 (Mobile-First MDB).
 * ======================================================================== */
import '../styles/global.css';
import { getSession } from '../features/auth/session-logic';
import { AUTH_COOKIE_NAME } from '../features/auth/auth-config';

interface Props {
	title: string;
}

const { title } = Astro.props;
const session = await getSession(Astro.cookies.get(AUTH_COOKIE_NAME)?.value);
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="generator" content={Astro.generator} />
		<title>{title} | Pharos Web Console</title>
	</head>
	<body class="bg-slate-50 text-slate-900 font-sans antialiased min-h-screen flex flex-col">
		<header class="bg-white border-b border-slate-200 sticky top-0 z-10">
			<div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
				<a href="/" class="flex items-center space-x-2 hover:opacity-80 transition-opacity">
					<span class="text-2xl font-bold tracking-tight text-slate-950">Pharos<span class="text-blue-600">Console</span></span>
				</a>
				<nav class="flex items-center space-x-4">
                    <a href="/mdb" class="text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors hidden sm:block">Search MDB</a>
                    <a href="/pulse" class="text-sm font-medium text-slate-600 hover:text-green-600 transition-colors hidden sm:block">Pulse Monitor</a>
					
                    {session ? (
                        <div class="flex items-center space-x-3 pl-2 border-l border-slate-200">
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">{session.userId}</span>
                            <button id="logoutBtn" class="text-xs font-medium text-red-600 hover:text-red-500 transition-colors">Logout</button>
                        </div>
                    ) : (
                        <a href="/login" class="px-4 py-1.5 bg-slate-900 text-white text-xs font-bold rounded-lg hover:bg-slate-800 transition-colors">Sign In</a>
                    )}

					<div class="h-8 w-8 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center cursor-help" title="Help">
						<span class="text-xs font-medium text-slate-500">?</span>
					</div>
				</nav>
			</div>
		</header>

        <script>
            import { actions } from 'astro:actions';
            import { navigate } from 'astro:transitions/client';

            const logoutBtn = document.querySelector('#logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    await actions.logout();
                    navigate('/login');
                });
            }
        </script>

		<main class="flex-grow w-full max-w-4xl mx-auto px-4 py-6 sm:py-8 space-y-6 sm:space-y-8">
            <slot />
		</main>

		<footer class="mt-auto border-t border-slate-200 bg-white">
            <div class="max-w-4xl mx-auto px-4 py-6">
                <p class="text-center text-slate-500 text-sm italic">
                    Powered by the Pharos Protocol. Optimized for Home Lab & Enterprise DevSecOps.
                </p>
            </div>
		</footer>
	</body>
</html>
