---
/* ========================================================================
 * Project: pharos
 * Component: Web Console
 * File: src/pages/mdb/index.astro
 * Author: Richard D. (https://github.com/iamrichardd)
 * License: AGPL-3.0 (See LICENSE file for details)
 * * Purpose (The "Why"):
 * The main searchable interface for machine/infrastructure records (MDB).
 * Uses Vertical Slice Architecture to delegate logic and UI.
 * * Traceability:
 * Related to Task 16.6 (Issue #69).
 * ======================================================================== */
import ConsoleLayout from '../../layouts/ConsoleLayout.astro';
import MdbSearchForm from '../../features/mdb/search/MdbSearchForm.astro';
import MdbResultsGrid from '../../features/mdb/search/MdbResultsGrid.astro';
import { searchMdb } from '../../features/mdb/search/search-logic';
import type { PharosResponse } from '../../lib/pharos';

let query = Astro.url.searchParams.get('q') || '';
let result: PharosResponse | null = null;
let error: string | null = null;

if (query.trim() !== '') {
    try {
        result = await searchMdb(query);
    } catch (e: any) {
        error = e.message || 'Failed to connect to Pharos server';
    }
}
---

<ConsoleLayout title="Search MDB">
    <div class="space-y-6">
        <div>
            <h1 class="text-2xl font-bold text-slate-900 sm:text-3xl">Search MDB</h1>
            <p class="text-slate-600">Find machine and infrastructure records by IP, MAC, hostname, or alias.</p>
        </div>

        <MdbSearchForm query={query} />

        <MdbResultsGrid result={result} error={error} />
    </div>
</ConsoleLayout>
